---
title: "Stanford Open Policing Project Regression"
author: "Daniel Coker" 
date: "4/27/25"
format: html
execute: 
  warning: false
  message: false
---

## Introduction

This analysis explores trends in traffic stops across three California cities (San Francisco, Oakland, San Jose) using data from the Stanford Open Policing Project database. The primary goals of this analysis are to examine:

- How arrest rates changed over time (2014-2017).
- Whether search rates differ by race across the three cities.

These cities were chosen due to their diverse populations and significant differences in policing practices. The analysis uses SQL to directly query and wrangle the data, ensuring efficient and accurate results.

## Data Connection and Setup

```{r}
library(DBI)
library(RMariaDB)

con_traffic <- DBI::dbConnect(
  RMariaDB::MariaDB(),
  dbname = "traffic",
  host = Sys.getenv("TRAFFIC_HOST"),
  user = Sys.getenv("TRAFFIC_USER"),
  password = Sys.getenv("TRAFFIC_PWD")
)
```

## Arrest Rates Over Time per City

```{sql, connection=con_traffic, output.var="arrest_trend"} 
SELECT
    city,
    stop_year,
    ROUND(100.0 * AVG(CASE WHEN arrest_made THEN 1 ELSE 0 END), 2) AS arrest_rate
FROM (
    SELECT 'San Francisco' AS city, YEAR(date) AS stop_year, arrest_made
    FROM ca_san_francisco_2020_04_01
    WHERE YEAR(date) BETWEEN 2014 AND 2017

    UNION ALL

    SELECT 'Oakland' AS city, YEAR(date) AS stop_year, arrest_made
    FROM ca_oakland_2020_04_01
    WHERE YEAR(date) BETWEEN 2014 AND 2017

    UNION ALL

    SELECT 'San Jose' AS city, YEAR(date) AS stop_year, arrest_made
    FROM ca_san_jose_2020_04_01
    WHERE YEAR(date) BETWEEN 2014 AND 2017
) AS combined
GROUP BY city, stop_year
ORDER BY city, stop_year;
```

```{r}
library(ggplot2)

ggplot(arrest_trend, aes(x = stop_year, y = arrest_rate, color = city)) +
  geom_line(size = 1.2) +
  geom_point(size = 2) +
  labs(title = "Arrest Rate Trends (2014-2017)", x = "Year (2014-2017)", y = "Arrest Rate (%)", color = "City") +
  theme_minimal() + theme(text = element_text(size = 12))
```

## Search Rates by Race & City

```{sql, connection= con_traffic, output.var="race_search"} 
SELECT
    city,
    subject_race,
    ROUND(100.0 * AVG(CASE WHEN search_conducted THEN 1 ELSE 0 END), 2) AS search_rate
FROM (
    SELECT 'San Francisco' AS city, subject_race, search_conducted
    FROM ca_san_francisco_2020_04_01
    WHERE YEAR(date) BETWEEN 2014 AND 2017

    UNION ALL

    SELECT 'Oakland' AS city, subject_race, search_conducted
    FROM ca_oakland_2020_04_01
    WHERE YEAR(date) BETWEEN 2014 AND 2017

    UNION ALL

    SELECT 'San Jose' AS city, subject_race, search_conducted
    FROM ca_san_jose_2020_04_01
    WHERE YEAR(date) BETWEEN 2014 AND 2017
) AS combined
GROUP BY city, subject_race
ORDER BY city, search_rate DESC;
```

```{r}
ggplot(race_search, aes(x = reorder(subject_race, -search_rate), y = search_rate, fill = city)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Search Rates by Race (2014-2017)", x = "Race", y = "Search Rate (%)", fill = "City") +
  theme_minimal() + theme(text = element_text(size = 12))
```

## Conclusion

This analysis reveals the following key insights:

1. Arrest rates were highest in Oakland but declined after 2016, potentially reflecting police reform efforts.
2. Search rates were consistently higher for Black and Hispanic drivers across all three cities, with Oakland showing the largest disparities.
3. Despite some reforms, racial disparities persisted in search rates from 2014 to 2017.

### References

- Stanford Open Policing Project — https://openpolicing.stanford.edu/data/
- Pierson, Emma, et al. 2020. “A Large-Scale Analysis of Racial Disparities in Police Stops Across the United States.” Nature Human Behaviour, 1–10.
