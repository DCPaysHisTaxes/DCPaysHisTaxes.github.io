---
title: "Chick Premutation"
author: "Daniel Coker"
format: html
execute:
  warning: false
  message: false
---

```{r}
library(tidyverse)
library(ggplot2)
library(infer)
data("ChickWeight")
```

1.  Chick Weight Dataset

The "Chick Weight" dataset records the weight of chicks measured throughout time. It is one of the include datasets in R. The variables included are weight, time, chick (unique idenitier of each chick, and diet (coded as 1-4) where the higher number represents the percentage of protein in a diet plan with 1 representing a diet that contains 10% protein and a 4 representing a diet that contains 40% protein. 

My research question for my premuatation that I want to explore is is there a significant difference between weight gain for chicks between a low protein diet, 1, and a high protein diet, 4. Thus, for this project, I only will be using the 'weight' and 'diet' variables. My $H_0$ would mean that there is no relationship between diet and weight while my $H_A$ suggest that there is a relationship between them. 

Here is the permutation test:
```{r}
chick_data <- ChickWeight |> 
  filter(Time == max(Time)) 

# Keep only Diet 1 and Diet 4
chick_data_filtered <- chick_data |> 
  filter(Diet %in% c(1, 4))

# Compute observed difference in means using map_dbl()
obs_diff <- chick_data_filtered |> 
  group_by(Diet) |> 
  summarize(mean_weight = mean(weight), .groups = "drop") |> 
  summarize(diff = diff(mean_weight)) |> 
  pull(diff)

# Permutation test using map()
set.seed(47)
perm_results <- chick_data_filtered |> 
  specify(weight ~ Diet) |> 
  hypothesize(null = "independence") |> 
  generate(reps = 4700, type = "permute") |> 
  calculate(stat = "diff in means", order = c("1", "4"))

# Compute p-value using map_dbl()
p_value <- mean(map_dbl(perm_results$stat, ~ .x >= obs_diff))

# Plot null distribution
ggplot(perm_results, aes(x = stat)) +
  geom_histogram(binwidth = 5, fill = "lightgreen", color = "black") +
  geom_vline(xintercept = obs_diff, color = "red", linetype = "dashed") +
  ggtitle("Null Distribution") +
  xlab("Difference in Mean Weight") +
  ylab("Frequency")

p_value  # Print p-value
```
For my project, I first filtered out all the other data I was not using, only keeping my chick's weights and diets 1 and 4. Then, I computed the observed difference from the mean of weight between diet 1 and 4. Using this, I then generate 4,700 premutation samples all using a different premutation for my test. From this, I then took the p-value of the premutation tests, giving me a low p-value of ~.0066 (sidenote: the p-value would have gone lower if I increased the repititions but chirp chirp). 

The null distribution histogram visualizes the differences in mean weight between diet 1 and 4 under $H_0$ assuming it is true. Each bar represents the frequence of a particular difference in means across our 4,700 permutation samples. The red dashed line represents the observed difference in means from the actual dataset, showing how extreme our observed results is compared to what would be expected by chance.


It is clear that the p-value of ~.0066 suggest that diet and a chick's weight are significantly related at 4,700 repititions. Since our observed difference line (dashed red line) is near the far-right tail, there is a very unlikely change that this would occur by chance, thus, we can disregard the $H_0$.There is a clear relationship between diet and protion of protein in it and weight.   
